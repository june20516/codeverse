<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="stylesheet" href="/_next/static/css/e8f9a37b33730b6d.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/41897fdb7555a39f.css" data-precedence="next"/><link rel="preload" as="script" href="https://www.googletagmanager.com/gtag/js?id=G-Q587R5F0YL"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" noModule=""></script></head><body><header class="flex items-center px-8"><a class="flex items-center" href="/"><div class="relative w-10 mr-4 aspect-square"><img alt="icon of codeverse" loading="lazy" decoding="async" data-nimg="fill" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="assets/images/codeverse_icon.png"/></div><h1 class="text-3xl font-bold">Codeverse</h1></a></header><aside><ul class="px-5"><li class="pt-4 border-b border-b-primary-900"><a class="block w-full h-fulltext-lg text-lg" href="/posts">Posts</a></li><li class="pt-4 border-b border-b-primary-900"><a class="block w-full h-fulltext-lg text-lg" href="/tags">Tags</a></li><li class="pt-4 border-b border-b-primary-900"><a class="block w-full h-fulltext-lg text-lg" href="/about">About Me</a></li></ul></aside><main class="overflow-auto"><div class="px-4"><article class="space-y-6"><div class="text-4xl font-bold text-center p-10 sticky top-0 bg-white max-h-96 min-h-fit">mysql dockerize(2) - mysql container에 볼륨 설정하기<p class="text-base text-right italic text-secondary-400"> - <!-- -->2021/11/13</p></div><div class="w-full bg-background-primary-100 p-4"><p class="font-semibold text-secondary-600">내 로컬 환경은 소중하니까</p></div><img src="/assets/images/posts/mysql-dockerize.jpeg" class="w-[90%] mx-auto" alt="thumbnail" loading="lazy"/><div class="markdown-body post"><h2 id="계속-쓸-수-있는-db-만들기" class="heading">계속 쓸 수 있는 DB 만들기</h2>
<p>일반적으로 도커 컨테이너는 프로세스가 종료되면 내부에서 일어났던 변경사항들은 날아갑니다. 재부팅이라도 하는 날에는 그 동안 컨테이너에서 생성했던 데이터들은 없던 일이 되죠. 물론 도커는 볼륨이라는 개념으로 데이터를 유지할 수 있는 기능을 제공합니다.
mysql 이미지는 이 기능을 내부적으로 사용하고 있어서, 컨테이너를 생성할 때 볼륨을 자동 생성합니다. 그래서 컨테이너를 실행하고 정지하는 것을 반복해도 데이터가 유지됩니다. 하지만 이 렇게 만들어진 볼륨은 컨테이너가 아예 삭제되어 버리는 경우 그 데이터를 보존할 수가 없습니다.
저는 몇 번 재설치를 하더라도 데이터는 별도로 관리할 수 있었으면 좋겠어요.</p>
<h3 id="볼륨">볼륨</h3>
<p>공식 문서에는 이렇게 쓰여있습니다.</p>
<blockquote>
<p>Volumes are the preferred mechanism for persisting data generated by and used by Docker containers.
While bind mounts are dependent on the directory structure and OS of the host machine, volumes are completely managed by Docker.</p>
</blockquote>
<p>데이터를 유지하기 위한 기본 메커니즘이라고 합니다. <code>Bind mount</code>라는 운영 체제의 파일 시스템을 컨테이너에 마운트 해 쓰는 기능이 있는데, 볼륨은 그 보다 더 폭넓은 기능을 제공하고, 관리를 도커 내에서 하기 때문에 도커를 실행하는 운영체제에 영향을 받지 않는다는 장점이 있습니다.</p>
<h3 id="볼륨-확인">볼륨 확인</h3>
<p>먼저 기본으로 생성되는 볼륨을 확인해 보겠습니다.</p>
<pre class="language-shell"><code class="language-shell code-highlight"><span class="code-line">$ <span class="token function">docker</span> run <span class="token parameter variable">--name</span> mysql <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">1234</span> <span class="token parameter variable">-d</span> mysql
</span><span class="code-line">e94b0ab7eed5b1d147147ffe5b170d1520ee680f7b3ab7511e4e0fb4fb9a1925
</span><span class="code-line">
</span><span class="code-line">$  <span class="token function">docker</span> volume list
</span><span class="code-line">DRIVER    VOLUME NAME
</span><span class="code-line"><span class="token builtin class-name">local</span>     b97c5432ff0a86802d2cbca69484448f1ecd5c530ddcad7e4b7eea3c6ec2e8c5
</span></code></pre>
<p><code>docker volume list</code>로 볼륨의 리스트를 확인하면 임의의 해시로 설정된 볼륨이 생성된 것을 확인할 수 있습니다.
그럼 컨테이너를 삭제하고 다시 실행해 보겠습니다.</p>
<pre class="language-shell"><code class="language-shell code-highlight"><span class="code-line">$ <span class="token function">docker</span> stop mysql
</span><span class="code-line">mysql
</span><span class="code-line">
</span><span class="code-line">$ <span class="token function">docker</span> <span class="token function">rm</span> mysql
</span><span class="code-line">mysql
</span><span class="code-line">
</span><span class="code-line">$ <span class="token function">docker</span> run <span class="token parameter variable">--name</span> mysql <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">1234</span> <span class="token parameter variable">-d</span> mysql
</span><span class="code-line">456be35825bc8b1b7d2a4494c8b160ab578730f31a625a775abea271b036eae7
</span><span class="code-line">
</span><span class="code-line">$ <span class="token function">docker</span> volume list
</span><span class="code-line">DRIVER    VOLUME NAME
</span><span class="code-line"><span class="token builtin class-name">local</span>     6765f342d98d3f274a0d7c3b137e07e48e9c153764e372707b6d987018498e6d
</span><span class="code-line"><span class="token builtin class-name">local</span>     b97c5432ff0a86802d2cbca69484448f1ecd5c530ddcad7e4b7eea3c6ec2e8c5
</span></code></pre>
<p>아까 생성됐던 볼륨은 지워지지 않고 새로운 볼륨이 생성된 것을 확인할 수 있습니다. 지금은 볼륨 리스트로만 확인해봤지만 직접 컨테이너 안에 들어가서 데이터를 생성해보며 테스트를 해봐도 컨테이너를 삭제 후 생성하면 기존의 데이터가 없음을 확인할 수 있습니다.</p>
<h3 id="볼륨에-이름-부여하기">볼륨에 이름 부여하기</h3>
<p>컨테이너를 실행할 때 <code>-v {볼륨 이름||로컬 경로}:{컨테이너 안 경로}</code>또는 <code>--volume={볼륨 이름||로컬 경로}:{컨테이너 안 경로}</code> 옵션을 부여하여 볼륨을 직접 설정할 수 있습니다. mysql 이미지 안에서 볼륨은 <code>/var/lib/mysql</code>에 마운트 되어야 하기 때문에, 해당 경로와 임의의 이름으로 옵션을 부여합니다. 아래에서는 이름을 <code>mysql-volume</code>으로 설정했습니다.</p>
<pre class="language-shell"><code class="language-shell code-highlight"><span class="code-line">$ <span class="token function">docker</span> run <span class="token parameter variable">--name</span> mysql <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">1234</span> <span class="token parameter variable">-v</span> mysql-volume:/var/lib/mysql <span class="token parameter variable">-d</span> mysql
</span></code></pre>
<p><code>myslq-volume</code>이라는 이름의 볼륨을 <code>mysql</code>이라는 이름의 컨테이너에 쓰기로 했으니, 이제 다시 볼륨 목록을 확인해 보겠습니다.</p>
<pre class="language-shell"><code class="language-shell code-highlight"><span class="code-line">$ <span class="token function">docker</span> volume list
</span><span class="code-line">DRIVER    VOLUME NAME
</span><span class="code-line"><span class="token builtin class-name">local</span>     6765f342d98d3f274a0d7c3b137e07e48e9c153764e372707b6d987018498e6d
</span><span class="code-line"><span class="token builtin class-name">local</span>     b97c5432ff0a86802d2cbca69484448f1ecd5c530ddcad7e4b7eea3c6ec2e8c5
</span><span class="code-line"><span class="token builtin class-name">local</span>     mysql-volume
</span></code></pre>
<p>볼륨이 생성되었습니다. 이제 이름이 존재하는 볼륨을 사용하니까, 컨테이너를 계속 삭제해도 볼륨을 직접 제거하지 않는 한 볼륨 옵션을 명시하여 동일한 볼륨을 계속 쓸 수 있습니다.</p>
<h3 id="볼륨-삭제하기">볼륨 삭제하기</h3>
<p>불필요한 볼륨들은 삭제합시다.</p>
<ol>
<li>컨테이너를 삭제할 때 같이 삭제하는 방법으로, 컨테이너 삭제 명령에 <code>-v</code>옵션을 줄 수 있습니다.</li>
</ol>
<pre class="language-shell"><code class="language-shell code-highlight"><span class="code-line">$ <span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-v</span> mysql
</span></code></pre>
<ol start="2">
<li>위에서 했던 것과 같이 볼륨 리스트를 보고 직접 해시네임을 선택해 삭제할 수도 있습니다.</li>
</ol>
<pre class="language-shell"><code class="language-shell code-highlight"><span class="code-line">$ <span class="token function">docker</span> volume <span class="token function">rm</span> 6765f342d98d3f274a0d7c3b137e07e48e9c153764e372707b6d987018498e6d
</span></code></pre>
<ol start="3">
<li>로컬에 생성되어있고 컨테이너에 연결되지 않은(==dangling상태의) 모든 볼륨을 다 삭제하는 명령어도 있습니다.</li>
</ol>
<pre class="language-shell"><code class="language-shell code-highlight"><span class="code-line">$ <span class="token function">docker</span> volume prune
</span></code></pre>
<hr>
<p>시리즈의 다음 글에서는, 로컬에서 사용하던 데이터 베이스를 그대로 사용하기 위해서 dump파일을 database에 밀어넣는 방법을 알아보겠습니다.</p></div></article></div></main><!--$!--><template data-dgst="NEXT_DYNAMIC_NO_SSR_CODE"></template><!--/$--><script src="/_next/static/chunks/webpack-4c9767a598128d4d.js" async=""></script><script src="/_next/static/chunks/2443530c-424cdbcd2566cb72.js" async=""></script><script src="/_next/static/chunks/488-e94a566894f82f75.js" async=""></script><script src="/_next/static/chunks/main-app-98d28d7655df5891.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/e8f9a37b33730b6d.css\",{\"as\":\"style\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/41897fdb7555a39f.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"4:I{\"id\":\"8827\",\"chunks\":[\"272:static/chunks/webpack-4c9767a598128d4d.js\",\"667:static/chunks/2443530c-424cdbcd2566cb72.js\",\"488:static/chunks/488-e94a566894f82f75.js\"],\"name\":\"\",\"async\":false}\n6:I{\"id\":\"9126\",\"chunks\":[\"272:static/chunks/webpack-4c9767a598128d4d.js\",\"667:static/chunks/2443530c-424cdbcd2566cb72.js\",\"488:static/chunks/488-e94a566894f82f75.js\"],\"name\":\"\",\"async\":false}\n7:I{\"id\":\"1273\",\"chunks\":[\"920:static/chunks/920-4cc7de8e14e4b1e5.js\",\"707:static/chunks/707-de92662865eaa972.js\",\"185:static/"])</script><script>self.__next_f.push([1,"chunks/app/layout-db7bd22285a3227e.js\"],\"name\":\"\",\"async\":false}\n8:I{\"id\":\"8920\",\"chunks\":[\"920:static/chunks/920-4cc7de8e14e4b1e5.js\",\"605:static/chunks/app/tags/[tag]/page-a47a3d6f9534bd88.js\"],\"name\":\"\",\"async\":false}\n9:I{\"id\":\"8707\",\"chunks\":[\"920:static/chunks/920-4cc7de8e14e4b1e5.js\",\"707:static/chunks/707-de92662865eaa972.js\",\"185:static/chunks/app/layout-db7bd22285a3227e.js\"],\"name\":\"\",\"async\":false}\nb:\"$Sreact.suspense\"\nc:I{\"id\":\"2126\",\"chunks\":[\"920:static/chunks/920-4cc7de8e14e4b1e5.js\",\"707:stat"])</script><script>self.__next_f.push([1,"ic/chunks/707-de92662865eaa972.js\",\"185:static/chunks/app/layout-db7bd22285a3227e.js\"],\"name\":\"\",\"async\":false}\nd:I{\"id\":\"4463\",\"chunks\":[\"272:static/chunks/webpack-4c9767a598128d4d.js\",\"667:static/chunks/2443530c-424cdbcd2566cb72.js\",\"488:static/chunks/488-e94a566894f82f75.js\"],\"name\":\"\",\"async\":false}\ne:I{\"id\":\"1010\",\"chunks\":[\"272:static/chunks/webpack-4c9767a598128d4d.js\",\"667:static/chunks/2443530c-424cdbcd2566cb72.js\",\"488:static/chunks/488-e94a566894f82f75.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e8f9a37b33730b6d.css\",\"precedence\":\"next\"}]],[\"$\",\"$L4\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/mysql-dockerize-2\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"mysql-dockerize-2\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"mysql-dockerize-2\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$L5\",null],\"globalErrorComponent\":\"$6\",\"notFound\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[null,[\"$\",\"$L7\",null,{\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-Q587R5F0YL\"}],[\"$\",\"$L7\",null,{\"id\":\"google-analytics\",\"dangerouslySetInnerHTML\":{\"__html\":\"\\n            window.dataLayer = window.dataLayer || [];\\n            function gtag(){dataLayer.push(arguments);}\\n            gtag('js', new Date());\\n   \\n            gtag('config', 'G-Q587R5F0YL');\\n          \"}}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center px-8\",\"children\":[\"$\",\"$L8\",null,{\"href\":\"/\",\"className\":\"flex items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"relative w-10 mr-4 aspect-square\",\"children\":[\"$\",\"$L9\",null,{\"src\":\"assets/images/codeverse_icon.png\",\"fill\":true,\"alt\":\"icon of codeverse\"}]}],[\"$\",\"h1\",null,{\"className\":\"text-3xl font-bold\",\"children\":\"Codeverse\"}]]}]}],[\"$\",\"aside\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"px-5\",\"children\":[[\"$\",\"li\",\"0\",{\"className\":\"pt-4 border-b border-b-primary-900\",\"children\":[\"$\",\"$L8\",null,{\"className\":\"block w-full h-fulltext-lg text-lg\",\"href\":\"/posts\",\"children\":\"Posts\"}]}],[\"$\",\"li\",\"1\",{\"className\":\"pt-4 border-b border-b-primary-900\",\"children\":[\"$\",\"$L8\",null,{\"className\":\"block w-full h-fulltext-lg text-lg\",\"href\":\"/tags\",\"children\":\"Tags\"}]}],[\"$\",\"li\",\"2\",{\"className\":\"pt-4 border-b border-b-primary-900\",\"children\":[\"$\",\"$L8\",null,{\"className\":\"block w-full h-fulltext-lg text-lg\",\"href\":\"/about\",\"children\":\"About Me\"}]}]]}]}],[\"$\",\"main\",null,{\"className\":\"overflow-auto\",\"children\":[\"$La\",\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}],[\"$\",\"$b\",null,{\"fallback\":null,\"children\":[\"$\",\"$Lc\",null,{}]}]]}]]}],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[null,[\"$\",\"$L7\",null,{\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-Q587R5F0YL\"}],[\"$\",\"$L7\",null,{\"id\":\"google-analytics\",\"dangerouslySetInnerHTML\":{\"__html\":\"\\n            window.dataLayer = window.dataLayer || [];\\n            function gtag(){dataLayer.push(arguments);}\\n            gtag('js', new Date());\\n   \\n            gtag('config', 'G-Q587R5F0YL');\\n          \"}}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center px-8\",\"children\":[\"$\",\"$L8\",null,{\"href\":\"/\",\"className\":\"flex items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"relative w-10 mr-4 aspect-square\",\"children\":[\"$\",\"$L9\",null,{\"src\":\"assets/images/codeverse_icon.png\",\"fill\":true,\"alt\":\"icon of codeverse\"}]}],[\"$\",\"h1\",null,{\"className\":\"text-3xl font-bold\",\"children\":\"Codeverse\"}]]}]}],[\"$\",\"aside\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"px-5\",\"children\":[[\"$\",\"li\",\"0\",{\"className\":\"pt-4 border-b border-b-primary-900\",\"children\":[\"$\",\"$L8\",null,{\"className\":\"block w-full h-fulltext-lg text-lg\",\"href\":\"/posts\",\"children\":\"Posts\"}]}],[\"$\",\"li\",\"1\",{\"className\":\"pt-4 border-b border-b-primary-900\",\"children\":[\"$\",\"$L8\",null,{\"className\":\"block w-full h-fulltext-lg text-lg\",\"href\":\"/tags\",\"children\":\"Tags\"}]}],[\"$\",\"li\",\"2\",{\"className\":\"pt-4 border-b border-b-primary-900\",\"children\":[\"$\",\"$L8\",null,{\"className\":\"block w-full h-fulltext-lg text-lg\",\"href\":\"/about\",\"children\":\"About Me\"}]}]]}]}],[\"$\",\"main\",null,{\"className\":\"overflow-auto\",\"children\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[[null,[\"$\",\"div\",null,{\"className\":\"px-4\",\"children\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",[\"slug\",\"mysql-dockerize-2\",\"d\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lf\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"mysql-dockerize-2\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/41897fdb7555a39f.css\",\"precedence\":\"next\"}]]}]}]],null],\"segment\":[\"slug\",\"mysql-dockerize-2\",\"d\"]},\"styles\":[]}],\"segment\":\"posts\"},\"styles\":[]}]}],[\"$\",\"$b\",null,{\"fallback\":null,\"children\":[\"$\",\"$Lc\",null,{}]}]]}]]}],null]}]]\n"])</script><script>self.__next_f.push([1,"f:[null,[\"$\",\"article\",null,{\"className\":\"space-y-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-4xl font-bold text-center p-10 sticky top-0 bg-white max-h-96 min-h-fit\",\"children\":[\"mysql dockerize(2) - mysql container에 볼륨 설정하기\",[\"$\",\"p\",null,{\"className\":\"text-base text-right italic text-secondary-400\",\"children\":[\" - \",\"2021/11/13\"]}]]}],[\"$\",\"div\",null,{\"className\":\"w-full bg-background-primary-100 p-4\",\"children\":[\"$\",\"p\",null,{\"className\":\"font-semibold text-secondary-600\",\"children\":\"내 로컬 환경은 소중하니까\"}]}],[\"$\",\"img\",null,{\"src\":\"/assets/images/posts/mysql-dockerize.jpeg\",\"className\":\"w-[90%] mx-auto\",\"alt\":\"thumbnail\",\"loading\":\"lazy\"}],[\"$\",\"div\",null,{\"className\":\"markdown-body post\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ch2 id=\\\"계속-쓸-수-있는-db-만들기\\\" class=\\\"heading\\\"\u003e계속 쓸 수 있는 DB 만들기\u003c/h2\u003e\\n\u003cp\u003e일반적으로 도커 컨테이너는 프로세스가 종료되면 내부에서 일어났던 변경사항들은 날아갑니다. 재부팅이라도 하는 날에는 그 동안 컨테이너에서 생성했던 데이터들은 없던 일이 되죠. 물론 도커는 볼륨이라는 개념으로 데이터를 유지할 수 있는 기능을 제공합니다.\\nmysql 이미지는 이 기능을 내부적으로 사용하고 있어서, 컨테이너를 생성할 때 볼륨을 자동 생성합니다. 그래서 컨테이너를 실행하고 정지하는 것을 반복해도 데이터가 유지됩니다. 하지만 이 렇게 만들어진 볼륨은 컨테이너가 아예 삭제되어 버리는 경우 그 데이터를 보존할 수가 없습니다.\\n저는 몇 번 재설치를 하더라도 데이터는 별도로 관리할 수 있었으면 좋겠어요.\u003c/p\u003e\\n\u003ch3 id=\\\"볼륨\\\"\u003e볼륨\u003c/h3\u003e\\n\u003cp\u003e공식 문서에는 이렇게 쓰여있습니다.\u003c/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003eVolumes are the preferred mechanism for persisting data generated by and used by Docker containers.\\nWhile bind mounts are dependent on the directory structure and OS of the host machine, volumes are completely managed by Docker.\u003c/p\u003e\\n\u003c/blockquote\u003e\\n\u003cp\u003e데이터를 유지하기 위한 기본 메커니즘이라고 합니다. \u003ccode\u003eBind mount\u003c/code\u003e라는 운영 체제의 파일 시스템을 컨테이너에 마운트 해 쓰는 기능이 있는데, 볼륨은 그 보다 더 폭넓은 기능을 제공하고, 관리를 도커 내에서 하기 때문에 도커를 실행하는 운영체제에 영향을 받지 않는다는 장점이 있습니다.\u003c/p\u003e\\n\u003ch3 id=\\\"볼륨-확인\\\"\u003e볼륨 확인\u003c/h3\u003e\\n\u003cp\u003e먼저 기본으로 생성되는 볼륨을 확인해 보겠습니다.\u003c/p\u003e\\n\u003cpre class=\\\"language-shell\\\"\u003e\u003ccode class=\\\"language-shell code-highlight\\\"\u003e\u003cspan class=\\\"code-line\\\"\u003e$ \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e run \u003cspan class=\\\"token parameter variable\\\"\u003e--name\u003c/span\u003e mysql \u003cspan class=\\\"token parameter variable\\\"\u003e-e\u003c/span\u003e \u003cspan class=\\\"token assign-left variable\\\"\u003eMYSQL_ROOT_PASSWORD\u003c/span\u003e\u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e\u003cspan class=\\\"token number\\\"\u003e1234\u003c/span\u003e \u003cspan class=\\\"token parameter variable\\\"\u003e-d\u003c/span\u003e mysql\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003ee94b0ab7eed5b1d147147ffe5b170d1520ee680f7b3ab7511e4e0fb4fb9a1925\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e$  \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e volume list\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003eDRIVER    VOLUME NAME\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e\u003cspan class=\\\"token builtin class-name\\\"\u003elocal\u003c/span\u003e     b97c5432ff0a86802d2cbca69484448f1ecd5c530ddcad7e4b7eea3c6ec2e8c5\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e\u003ccode\u003edocker volume list\u003c/code\u003e로 볼륨의 리스트를 확인하면 임의의 해시로 설정된 볼륨이 생성된 것을 확인할 수 있습니다.\\n그럼 컨테이너를 삭제하고 다시 실행해 보겠습니다.\u003c/p\u003e\\n\u003cpre class=\\\"language-shell\\\"\u003e\u003ccode class=\\\"language-shell code-highlight\\\"\u003e\u003cspan class=\\\"code-line\\\"\u003e$ \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e stop mysql\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003emysql\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e$ \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e \u003cspan class=\\\"token function\\\"\u003erm\u003c/span\u003e mysql\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003emysql\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e$ \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e run \u003cspan class=\\\"token parameter variable\\\"\u003e--name\u003c/span\u003e mysql \u003cspan class=\\\"token parameter variable\\\"\u003e-e\u003c/span\u003e \u003cspan class=\\\"token assign-left variable\\\"\u003eMYSQL_ROOT_PASSWORD\u003c/span\u003e\u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e\u003cspan class=\\\"token number\\\"\u003e1234\u003c/span\u003e \u003cspan class=\\\"token parameter variable\\\"\u003e-d\u003c/span\u003e mysql\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e456be35825bc8b1b7d2a4494c8b160ab578730f31a625a775abea271b036eae7\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e$ \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e volume list\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003eDRIVER    VOLUME NAME\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e\u003cspan class=\\\"token builtin class-name\\\"\u003elocal\u003c/span\u003e     6765f342d98d3f274a0d7c3b137e07e48e9c153764e372707b6d987018498e6d\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e\u003cspan class=\\\"token builtin class-name\\\"\u003elocal\u003c/span\u003e     b97c5432ff0a86802d2cbca69484448f1ecd5c530ddcad7e4b7eea3c6ec2e8c5\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e아까 생성됐던 볼륨은 지워지지 않고 새로운 볼륨이 생성된 것을 확인할 수 있습니다. 지금은 볼륨 리스트로만 확인해봤지만 직접 컨테이너 안에 들어가서 데이터를 생성해보며 테스트를 해봐도 컨테이너를 삭제 후 생성하면 기존의 데이터가 없음을 확인할 수 있습니다.\u003c/p\u003e\\n\u003ch3 id=\\\"볼륨에-이름-부여하기\\\"\u003e볼륨에 이름 부여하기\u003c/h3\u003e\\n\u003cp\u003e컨테이너를 실행할 때 \u003ccode\u003e-v {볼륨 이름||로컬 경로}:{컨테이너 안 경로}\u003c/code\u003e또는 \u003ccode\u003e--volume={볼륨 이름||로컬 경로}:{컨테이너 안 경로}\u003c/code\u003e 옵션을 부여하여 볼륨을 직접 설정할 수 있습니다. mysql 이미지 안에서 볼륨은 \u003ccode\u003e/var/lib/mysql\u003c/code\u003e에 마운트 되어야 하기 때문에, 해당 경로와 임의의 이름으로 옵션을 부여합니다. 아래에서는 이름을 \u003ccode\u003emysql-volume\u003c/code\u003e으로 설정했습니다.\u003c/p\u003e\\n\u003cpre class=\\\"language-shell\\\"\u003e\u003ccode class=\\\"language-shell code-highlight\\\"\u003e\u003cspan class=\\\"code-line\\\"\u003e$ \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e run \u003cspan class=\\\"token parameter variable\\\"\u003e--name\u003c/span\u003e mysql \u003cspan class=\\\"token parameter variable\\\"\u003e-e\u003c/span\u003e \u003cspan class=\\\"token assign-left variable\\\"\u003eMYSQL_ROOT_PASSWORD\u003c/span\u003e\u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e\u003cspan class=\\\"token number\\\"\u003e1234\u003c/span\u003e \u003cspan class=\\\"token parameter variable\\\"\u003e-v\u003c/span\u003e mysql-volume:/var/lib/mysql \u003cspan class=\\\"token parameter variable\\\"\u003e-d\u003c/span\u003e mysql\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e\u003ccode\u003emyslq-volume\u003c/code\u003e이라는 이름의 볼륨을 \u003ccode\u003emysql\u003c/code\u003e이라는 이름의 컨테이너에 쓰기로 했으니, 이제 다시 볼륨 목록을 확인해 보겠습니다.\u003c/p\u003e\\n\u003cpre class=\\\"language-shell\\\"\u003e\u003ccode class=\\\"language-shell code-highlight\\\"\u003e\u003cspan class=\\\"code-line\\\"\u003e$ \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e volume list\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003eDRIVER    VOLUME NAME\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e\u003cspan class=\\\"token builtin class-name\\\"\u003elocal\u003c/span\u003e     6765f342d98d3f274a0d7c3b137e07e48e9c153764e372707b6d987018498e6d\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e\u003cspan class=\\\"token builtin class-name\\\"\u003elocal\u003c/span\u003e     b97c5432ff0a86802d2cbca69484448f1ecd5c530ddcad7e4b7eea3c6ec2e8c5\\n\u003c/span\u003e\u003cspan class=\\\"code-line\\\"\u003e\u003cspan class=\\\"token builtin class-name\\\"\u003elocal\u003c/span\u003e     mysql-volume\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e볼륨이 생성되었습니다. 이제 이름이 존재하는 볼륨을 사용하니까, 컨테이너를 계속 삭제해도 볼륨을 직접 제거하지 않는 한 볼륨 옵션을 명시하여 동일한 볼륨을 계속 쓸 수 있습니다.\u003c/p\u003e\\n\u003ch3 id=\\\"볼륨-삭제하기\\\"\u003e볼륨 삭제하기\u003c/h3\u003e\\n\u003cp\u003e불필요한 볼륨들은 삭제합시다.\u003c/p\u003e\\n\u003col\u003e\\n\u003cli\u003e컨테이너를 삭제할 때 같이 삭제하는 방법으로, 컨테이너 삭제 명령에 \u003ccode\u003e-v\u003c/code\u003e옵션을 줄 수 있습니다.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cpre class=\\\"language-shell\\\"\u003e\u003ccode class=\\\"language-shell code-highlight\\\"\u003e\u003cspan class=\\\"code-line\\\"\u003e$ \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e \u003cspan class=\\\"token function\\\"\u003erm\u003c/span\u003e \u003cspan class=\\\"token parameter variable\\\"\u003e-v\u003c/span\u003e mysql\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003col start=\\\"2\\\"\u003e\\n\u003cli\u003e위에서 했던 것과 같이 볼륨 리스트를 보고 직접 해시네임을 선택해 삭제할 수도 있습니다.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cpre class=\\\"language-shell\\\"\u003e\u003ccode class=\\\"language-shell code-highlight\\\"\u003e\u003cspan class=\\\"code-line\\\"\u003e$ \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e volume \u003cspan class=\\\"token function\\\"\u003erm\u003c/span\u003e 6765f342d98d3f274a0d7c3b137e07e48e9c153764e372707b6d987018498e6d\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003col start=\\\"3\\\"\u003e\\n\u003cli\u003e로컬에 생성되어있고 컨테이너에 연결되지 않은(==dangling상태의) 모든 볼륨을 다 삭제하는 명령어도 있습니다.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cpre class=\\\"language-shell\\\"\u003e\u003ccode class=\\\"language-shell code-highlight\\\"\u003e\u003cspan class=\\\"code-line\\\"\u003e$ \u003cspan class=\\\"token function\\\"\u003edocker\u003c/span\u003e volume prune\\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\\n\u003chr\u003e\\n\u003cp\u003e시리즈의 다음 글에서는, 로컬에서 사용하던 데이터 베이스를 그대로 사용하기 위해서 dump파일을 database에 밀어넣는 방법을 알아보겠습니다.\u003c/p\u003e\"}}]]}]]\n"])</script><script>self.__next_f.push([1,"a:[[[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}],null,null,null,null,null,null,null,null,null,null,[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,null]\n5:[[[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}],null,null,null,null,null,null,null,null,null,null,[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],null,null,null,nu"])</script><script>self.__next_f.push([1,"ll,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}]],[],null]]\n"])</script></body></html>